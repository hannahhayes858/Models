---
title: "Hayes_Hunter-Selesitino"
data: 02-04-2026
format: html
editor: visual
---

```{r}
library(brms) # for statistics
library(tidyverse)
library(ggeffects) # for the prediction plot
library(lterdatasampler) # for built-in datasets
```

```{r}
head(pie_crab)
pie_crab
```

```{r}
#Loading ggplot package and lopading library
library(ggplot2)
pie_crab %>% ggplot(aes(x = latitude, y = size)) + geom_point() + 
# Make the y-axis include 0
   ylim(0, NA)
```

#### Q1.1

Yes there does appear to be a linear positive trend where as latitude increase size does as well. There seems to be a lot of variation, but does follow a gradual increase. We do not feel very confident, but we do believe there is a trend, but whether it is significant we are not entirely sure.

#### Q1.2

```{r}
library(ggplot2)
pie_crab %>% ggplot(aes(x = latitude, y = size, color = air_temp)) + geom_point() +
# Make the y-axis include 0
   ylim(0, NA) +
  labs(x = "Latitude", y = "Size (mm)", color = "Air Temperature (C)")

```



```{r}
# latitude model
m.crab.lat <- 
  brm(data = pie_crab, # Give the model the pie_crab data
      # Choose a gaussian (normal) distribution
      family = gaussian,
      # Specify the model here. 
      size ~ latitude,
      # Here's where you specify parameters for executing the Markov chains
      # We're using similar to the defaults, except we set cores to 4 so the analysis runs faster than the default of 1
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      # Setting the "seed" determines which random numbers will get sampled.
      # In this case, it makes the randomness of the Markov chain runs reproducible 
      # (so that both of us get the exact same results when running the model)
      seed = 4,
      # Save the fitted model object as output - helpful for reloading in the output later
      file = "output/m.crab.lat")
```


#### Q1.3: The iter argument specifies how many time the model will sample the posterier distribution.In other words the total number of iterations per chain.


```{r}
summary(m.crab.lat)
```



```{r}
plot(m.crab.lat) # show posteriors and chains
```




```{r}
summary(m.crab.lat)
```





```{r}
as_draws_df(m.crab.lat)  %>%  # extract the posterior samples from the model estimate
  select(b_latitude)  %>%  # pull out the latitude samples from all 4 chains. we'll get a warning that we can ignore.
  summarize(p_slope_lessthanorequalto_zero = sum(b_latitude <= 0)/length(b_latitude))

```



```{r}
# compatibility interval. the shows uncertainty in the average response.
confm.crab.lat <- predict_response(m.crab.lat)
plot(confm.crab.lat, show_data = TRUE) # shows variation in the average.

```

```{r}
# prediction interval. this shows uncertainty in the data around the average response.
confm.crab.lat <- predict_response(m.crab.lat, interval = 'prediction')
plot(confm.crab.lat, show_data = TRUE) # shows 95% confidence interval of points
```


#### Q1.4:

We predict that higher variability would be associated with larger crabs. Because generally we see larger species of crab in colder environments that experience more disturbance.

------------------------------------------------------------------------

#### Q1.5 Graph the data

```{r}
library(ggplot2)
pie_crab %>% ggplot(aes(x = water_temp_sd, y = size, color = water_temp)) + geom_point() +
# Make the y-axis include 0
   ylim(0, NA) +
  labs(x = "Water Temperature SD", y = "Fiddler Crab Boddy Size(mm)", color = "Water Temperature(C)")
```

#### Q1.6:

No, it does not look like size changes with standard deviation of water temperature. I feel very confident that there's not pattern to distinguish amongst the data.

------------------------------------------------------------------------

### Q1.7 Set up and run this new model


```{r}
# Water Temperature SD model 
m.crab.watersd <- 
  brm(data = pie_crab, # Give the model the pie_crab data
      # Choose a gaussian (normal) distribution
      family = gaussian,
      # Specify the model here. This case looking at size and Water Temp SD
      size ~ water_temp_sd,
      # Here's where you specify parameters for executing the Markov chains
      # We're using similar to the defaults, except we set cores to 4 so the analysis runs faster than the default of 1
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      # Setting the "seed" determines which random numbers will get sampled.
      # In this case, it makes the randomness of the Markov chain runs reproducible 
      # (so that both of us get the exact same results when running the model)
      seed = 4,
      # Save the fitted model object as output - helpful for reloading in the output later
      file = "output/m.crab.watersd")
```


#### Q1.8:

Since the Rhat value is equal to 1 and all of the chains (1-4) line up in a straight line across the graph, we feel confident that the model ran correctly.

```{r}
# show posteriors and chains
plot(m.crab.watersd) 

# show summary, including rhat
summary(m.crab.watersd)
```


#### Q1.9:

1.  The effect of the predictor variable is 0.10, meaning for every one unit of water temperature standard deviation, there was an increase of 0.10mm in fiddler crab body size.

2.  No, the effect is not reasonably different from zero because the credible interval (-0.23 - 0.42) intersects with zero. Therefore this tells us that given the model, there is a possibility that the predictor ( standard deviation of water temperature) could have no effect on fiddler crab body size.

```{r eval = FALSE}
# Show model output
summary(m.crab.watersd)
```


------------------------------------------------------------------------

# 2. Back to Pikas!

```{r}
head(nwt_pikas)
```


```{r}
# Extracting Day from the date and makint it its own column.
nwt_pikas_doy <- nwt_pikas %>% 
  # Add a new column called day_of_year
  # yday extracts the day of year from the date column
  mutate(day_of_year = yday(date)) %>% 
  # relocate the day_of_year column after the date column
  relocate(day_of_year, .after = date)

head(nwt_pikas_doy)
```

```{r}
# Tidying the data set further in order to create a graph we can use to visualize any kind of pattern.
nwt_pikas_categ <- nwt_pikas %>% # naming output of this code
# Call the new column stress_category
mutate(stress_category = case_when(
# When the value is > 5000, make the new column's value "Stressed!!!!"
concentration_pg_g > 5000 ~ "Stressed",
# Otherwise, make the new column's value "Chill"
.default = "Chill"
))
```


#### Q2.1:

Is the variation in elevations associated with the stress of pikas?


#### Q2.2:

We predict that higher elevations will be associated with higher stress levels in pika. Because generally, the environment at higher elevations are more unforgiving due to limited resource availability, such as plants which is the pikas main source of food, because not many plants are able to survive at such high elevations, as well as more limited land resources, so there are fewer viable territories available for pikas to choose from, leading to more conflict amongst individuals.



#### Q2.3 Graph the data

```{r}
head(nwt_pikas_categ) # checking column names
```


```{r}
library(ggplot2)
pika_stress_Plot1 <- ggplot(data = nwt_pikas_categ, aes(x = elev_m, y = concentration_pg_g, color = )) + 
  geom_point(aes(color=elev_m)) +
# Make the y-axis include 0
   ylim(0, NA) +
  labs(x = "Elevation (m)", y = "Conc. of Glucocorticoid Metabolite (GCM/gram)", color = "Elevation (m)")

pika_stress_Plot1
```




#### Q2.4:


```{r}
# Elevation and pika stress model 
nwt_pikas_elev_stress <- 
  brm(data = nwt_pikas_categ, # Give the model tidied pika data.frame
      # Chose a gaussian (normal) distribution
      family = gaussian,
      # Specified model. 
      concentration_pg_g ~ elev_m,
      # Here's where you specify parameters for executing the Markov chains
      # We're using similar to the defaults, except we set cores to 4 so the analysis runs faster than the default of 1
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      # Setting the "seed" determines which random numbers will get sampled.
      # In this case, it makes the randomness of the Markov chain runs reproducible 
      # (so that both of us get the exact same results when running the model)
      seed = 4,
      # Save the fitted model object as output - helpful for reloading in the output later
      file = "output/nwt_pikas_elev_stress")
```



#### Q2.5:

We are confident that our model ran correctly because our Rhat value was equal to 1, and the 4 chains all lined up with eachother and ran in a horizontal line across the graph.

```{r}
# show posteriors and 4 chains 
plot(nwt_pikas_elev_stress) 

# show summary, including Rhat
summary(nwt_pikas_elev_stress)
```

------------------------------------------------------------------------

#### Q2.6:

We found that there is a decrease of 0.31 GCM/gram of Glucocorticoid Metabolite per unit of elevation. However, our 95% credible intervals (-5.25 to 4.69) includes zero. Therefore given the model, it is possible that the effects of elevation(m) on the stress levels of pika is 0.

------------------------------------------------------------------------

#### Q2.7 Plot the model on the data


```{r}
# compatibility interval for pika stress and elevation. Shows uncertainty in the average response.
confm.pikas.elev.stress <- predict_response(nwt_pikas_elev_stress)
plot(confm.pikas.elev.stress, show_data = TRUE) # shows variation in the average.
```

------------------------------------------------------------------------

#### Q2.8:

Despite the estimate showing a decrease of 0.31 GCM/grams of Glucocorticoid Metabolite in pika fecal samplers per unit of elevation. With the 95% credible interval (-5.25 to 4.69) containing 0 within its bounds it is possible that the effects of elevation(m) on the stress levels of pika is 0. Furthermore, the results of the compatibility interval shows more variation in Glucocorticoid Metabolite levels in lower elevations compared to higher ones, yet the overall mean trend is a linear horizontal line, indicating no correlation. In conclusion elevation appears to have no effect on pika stress levels.

------------------------------------------------------------------------

### Bonus: Repeat with the other variable for practice

If you have extra time and would like more practice, you may optionally repeat these analyses with the other predictor variable.

------------------------------------------------------------------------

Throughout this activity, both datasets had multiple possible predictor variables that we chose between to model our response variable of interest: crab body size had latitude, temperature, and the variability of temperature. Pika stress had elevation and day of year. You may be wondering: why do we have to choose only one variable? Is it possible that both variables are important in their own way?

This is a great question, and is the foundation for what we will do next week, which is *multiple regression*: a way of setting up models while incorporating the influence of multiple predictors *at the same time*!

------------------------------------------------------------------------

### Render to PDF

When you have finished, practice the GitHub push/pull:

-   Pull to check for updates to the remote branch
-   Stage your edits (after saving your document!) by checking the documents you'd like to push
-   Commit your changes with a commit message
-   Push your changes to the remote branch

And submit the well-labeled PDF on Gradescope. Thanks!
